{%- style -%}
  .announcement-bar {
    background-color: {{ section.settings.bg_color }};
    color: {{ section.settings.text_color }};
    padding: 10px 0;
    text-align: center;
    font-size: 14px;
    font-weight: 500;
    position: relative;
    overflow: hidden;
  }
  .announcement-bar__message {
    margin: 0;
    display: none; /* Hidden by default, shown by JS */
  }
  .announcement-bar__message.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }
  .announcement-bar a {
    color: inherit;
    text-decoration: underline;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
{%- endstyle -%}

<div class="announcement-bar" id="AnnouncementBar-{{ section.id }}">
  {%- for block in section.blocks -%}
    <div class="announcement-bar__message {% if forloop.first %}active{% endif %}" 
         data-index="{{ forloop.index0 }}" 
         {{ block.shopify_attributes }}>
      {%- if block.settings.link != blank -%}
        <a href="{{ block.settings.link }}">
      {%- endif -%}
          {{ block.settings.text }}
      {%- if block.settings.link != blank -%}
        </a>
      {%- endif -%}
    </div>
  {%- endfor -%}
</div>

{%- if section.blocks.size > 1 -%}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const messages = document.querySelectorAll('#AnnouncementBar-{{ section.id }} .announcement-bar__message');
    let current = 0;
    
    setInterval(() => {
      messages[current].classList.remove('active');
      current = (current + 1) % messages.length;
      messages[current].classList.add('active');
    }, {{ section.settings.delay | times: 1000 }});
  });
</script>
{%- endif -%}

{% schema %}
{
  "name": "Announcement Bar",
  "max_blocks": 5,
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "delay",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Rotation Speed (Seconds)",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Free shipping on orders over $50"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (Optional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Announcement Bar",
      "blocks": [
        { "type": "announcement" }
      ]
    }
  ]
}
{% endschema %}